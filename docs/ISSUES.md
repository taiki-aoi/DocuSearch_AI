# 課題管理

このドキュメントでは、DocuSearch_AIの既知の課題と対応状況を管理します。

---

## 未解決の課題

### Issue #1: フィルター機能・画像アクション分岐の問題

**ステータス**: 🔴 未解決

**現象**:
- 削除したファイルがDifyに連携されない
- 既に登録済みのファイルが再度処理される（重複登録）

**影響範囲**:
- n8n ワークフロー: `local-folder-monitor.json`
- 画像処理分岐ロジック

**期待する動作**:
- 新規ファイルのみ処理する
- 削除されたファイルはDifyからも削除される
- 既存ファイルはスキップする

**調査ポイント**:
- [ ] 処理済みファイルの判定ロジック
- [ ] ファイル削除検知の実装
- [ ] Dify側のドキュメント削除API連携

---

### Issue #2: フォルダ同期機能の改善

**ステータス**: 🔴 未解決

**対象フォルダ**:
```
C:\Users\begin\Desktop\wk\02.実験\DocuSearch_AI\watch\documents
C:\Users\begin\Desktop\wk\02.実験\DocuSearch_AI\watch\images
```

**要件**:

| 操作 | 期待する動作 | 現状 |
| ---- | ------------ | ---- |
| ファイル追加 | 差分のみDifyに登録 | △ 重複登録の可能性あり |
| ファイル変更 | 更新をDifyに反映 | × 未実装 |
| ファイル削除 | Difyからも削除 | × 未実装 |

**必要な実装**:
- [ ] 処理済みファイルリストの永続化（DB or ファイル）
- [ ] ファイルハッシュによる変更検知
- [ ] 削除検知とDify同期削除
- [ ] Dify Document ID とローカルファイルの紐付け管理

**技術的な検討事項**:
```
【同期方式の選択肢】

A) ファイルベース管理
   - processed_files.json にファイルパスとDify Document IDを保存
   - シンプルだが、大量ファイルでパフォーマンス懸念

B) データベース管理
   - PostgreSQLに同期テーブルを作成
   - スケーラブルだが、実装コスト増

C) n8n内蔵のデータストア
   - n8nのstatic dataを活用
   - 手軽だが、データ量制限あり
```

---

## 解決済みの課題

### ~~Issue #0: 検索精度が低い~~

**ステータス**: ✅ 解決済み

**原因**: Embeddingモデル `embedding-001` の日本語対応が不十分

**解決策**: `gemini-embedding-001` に変更

**対応日**: 2024-12-20

---

## 優先度

| 優先度 | Issue | 理由 |
| ------ | ----- | ---- |
| 高 | #1 | 重複登録でナレッジベースが汚染される |
| 高 | #2 | 削除が反映されないと運用に支障 |

---

## 関連ドキュメント

- [アーキテクチャ](./ARCHITECTURE.md)
- [開発戦略](./DEVELOPMENT_STRATEGY.md)
- [n8nワークフロー設定](./N8N_WORKFLOW_SETUP.md)
